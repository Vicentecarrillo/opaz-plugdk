Work in progress - the algorithm is buggy, although the plugin will run.

Keeping original Java source aside for reference and debugging, although it's not actually used to prepare the plugin.